---
title: 'Gestion des Collectes et Dépôts'
---

## Gestion des Collectes

L'API de FedaPay permet d’intégrer facilement des solutions de paiement sécurisées dans votre site web ou application. Ce guide vous expliquera en détail comment configurer et gérer la collecte de paiements à l’aide de l’API, de la création initiale à la finalisation du processus, en passant par les fonctionnalités avancées comme les paiements sans redirection. Que vous soyez développeur ou responsable de produits, vous trouverez ici tout le nécessaire pour utiliser FedaPay de manière optimale.

### Étapes pour Créer et Gérer une Collecte de Paiement

Les étapes de configuration d’une collecte se divisent en plusieurs processus essentiels.

<Steps>
  <Step title=" Initialisation de la Collecte : Création d'une Requête">
    La première étape consiste à envoyer une requête de création de collecte via l’API. Cette requête nécessite certains paramètres obligatoires :

    - **description** : une brève description de l’objet de la collecte
    - **amount** : le montant, toujours en nombre entier
    - **currency** : la devise, indiquée par son numéro ou code ISO (référez-vous au Tableau des Devises FedaPay pour les détails)
    - **callback_url** : un lien de retour facultatif pour rediriger le client après le paiement
    - **customer** : le client concerné par la collecte

    Si le client n’est pas encore enregistré dans votre système, vous pouvez créer simultanément son profil en ajoutant des informations comme le nom, prénom, email, et numéro de téléphone.

    <Info>[Exemple de requête pour créer une collecte](/api-reference/transactions/create)</Info>

    <Note>
    Remplacez **VOTRE_CLE_API_SECRETE** par votre clé API et utilisez l’URL du serveur approprié (**sandbox** ou **live**).
    
    Si le client est déjà enregistré, utilisez simplement son ID ou email pour l’associer à la collecte.
    </Note>

  </Step>
  <Step title="Génération du Token et du Lien de Paiement">
    Une fois la requête envoyée, l'API renvoie un identifiant unique pour la collecte. Utilisez cet identifiant pour demander un lien et un token de paiement pour rediriger le client vers la page de paiement sécurisée.

    <CodeGroup>

    ```java cURL
    curl -X POST \
    https://sandbox-api.fedapay.com/v1/transactions/ID/token \
    -H 'Authorization: Bearer VOTRE_CLE_API_SECRETE' \
    -H 'Content-Type: application/json'
    ```

    ```PHP PHP
    $transaction = \FedaPay\Transaction::create(array(...))
    $token = $transaction->generateToken();
    return header('Location: ' . $token->url);
    ```

    ```javaScript NodeJS
    const transaction = await Transaction.create({...})
    const token = await transaction.generateToken();
    return redirect(token.url);
    ```
    </CodeGroup>

    Le lien ainsi généré peut être utilisé pour rediriger les utilisateurs vers la page de paiement de FedaPay.

  </Step>
  <Step title="Redirection vers la Page de Paiement">
    Ce lien redirige votre client vers une page de paiement sécurisée, où il pourra finaliser la collecte. Si vous avez spécifié un **callback_url**, votre client sera redirigé automatiquement à l’issue du paiement.
  </Step>
  <Step title="Utilisation du Lien de Retour (Callback URL)">
    Le **callback_url** permet de rediriger le client vers une page spécifique à la fin du paiement, avec le statut et l'ID de la collecte en paramètres. Par exemple :

    - **Paiement approuvé** : `https://www.monsite.com/?id=258&status=approved`
    - **Paiement annulé** : `https://www.monsite.com/?id=259&status=canceled`

  <Warning>
  **Attention** : Pour des raisons de sécurité, ne vous fiez pas au statut renvoyé par l'URL. 
  Effectuez toujours une vérification directe auprès de l’API pour obtenir le statut réel.
</Warning>

  </Step>
  <Step title=" Récupération des Détails d’une Collecte">
    Pour récupérer les informations complètes d’une collecte, effectuez une requête avec l'ID de cette collecte.

    <Info>[Exemple de requête pour récupérer les détails d’une collecte](/api-reference/transactions/get-by-id)</Info>

  </Step>
</Steps>

### Paiements sans Redirection

Pour offrir une expérience fluide sans redirection, vous pouvez intégrer le formulaire de paiement directement dans votre application pour certaines méthodes spécifiques (MTN Bénin, Moov Bénin, Moov Togo, et MTN Côte d'Ivoire). Ce mode peut s’avérer utile pour des sites e-commerce souhaitant garder l’utilisateur sur leur plateforme tout au long du processus.

**Envoi d’un paiement mobile sans redirection** :

1. **Créer une collecte** comme décrit précédemment, puis générer le token.
2. [Utilisez une des méthodes spécifiques suivantes](/payment-methods/fr/payment-methods-fr) pour traiter le paiement

<Warning>
**Remarque** : Le paiement sans redirection ne prend pas en charge tous les opérateurs. Pour les autres moyens de paiement comme Orange et les cartes bancaires, préférez le mode de redirection.
</Warning>

### Récupération Automatique du Statut d’une Collecte

Pour vérifier le statut final d’une collecte, surtout lors d’un paiement sans redirection :

- Envoyez une requête pour obtenir les détails de la collecte.
- **Implémentez un webhook** pour recevoir des notifications automatiques. [Consultez la section Webhooks pour plus de détails](/integration-api/fr/webhooks-fr).
